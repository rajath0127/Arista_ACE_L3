
interface Ethernet3
 description Uplink to Spine1
 no switchport
 ip address 10.10.1.2/31
 
interface Ethernet4
 description Uplink to Spine2
 no switchport
 ip address 10.10.2.2/31
 
interface Ethernet5
 description Uplink to Spine3
 no switchport
 ip address 10.10.3.2/31
 
interface Ethernet6
 description Uplink to Spine4
 no switchport
 ip address 10.10.4.2/31
 
interface Ethernet1
 description MLAG Peer Link to Leaf2
 switchport mode trunk
 channel-group 100 mode active
 
interface Ethernet2
 description MLAG Peer Link to Leaf2
 switchport mode trunk
 channel-group 100 mode active
 


interface Loopback0
 ip address 172.16.0.71/32
 no shutdown

interface Loopback1
 ip address 172.16.1.71/32
 no shutdown



vlan 10
 name Vlan10
 interface Vlan10
 ip address 172.16.10.1/24
 no autostate
 no shutdown

vlan 20
 name Vlan20
 interface Vlan20
 ip address 172.16.20.1/24
 no autostate
 no shutdown

vlan 4094
 name Vlan4094
 trunk group MLAGVLAN
 no spanning-tree vlan-id 4094
 interface Vlan4094
 ip address 172.16.255.1/30
 no autostate
 no shutdown



int Port-Channel100
 description Peer link MLAGLeaf1Leaf2
 switchport mode trunk
 switchport trunk group MLAGVLAN 
 no shutdown

mlag configuration
 domain-id MLAGLeaf1Leaf2
 local-interface Vlan4094
 peer-address 172.16.255.2
 peer-link Port-Channel100


ip virtual-router mac-address 001c.7300.0099

router bgp 65001
 router-id 172.16.0.71
 neighbor SpineUnderlay peer group
 neighbor 10.10.1.1 peer group SpineUnderlay
 neighbor 10.10.2.1 peer group SpineUnderlay
 neighbor 10.10.3.1 peer group SpineUnderlay
 neighbor 10.10.4.1 peer group SpineUnderlay
 neighbor SpineUnderlay remote-as 65000
 neighbor SpineUnderlay maximum-routes 12000
 address-family ipv4
  network 
  redistribute connected
  neighbor SpineUnderlay activate
 
 neighbor SpineOverlay peer group
 neighbor 172.16.0.101 peer group SpineOverlay
 neighbor 172.16.0.102 peer group SpineOverlay
 neighbor 172.16.0.103 peer group SpineOverlay
 neighbor 172.16.0.104 peer group SpineOverlay
 neighbor SpineOverlay remote-as 65000
 neighbor SpineOverlay update-source loopback0
 neighbor SpineOverlay send-community extended
 neighbor SpineOverlay ebgp-multihop 3
 neighbor SpineOverlay maximum-routes 12000
 address-family evpn
  neighbor SpineOverlay activate
 vlan 10
  rd 172.16.0.71:1010
  route-target both 1010:1010
  redistribute learned
 vlan 20
  rd 172.16.0.71:1020
  route-target both 1020:1020
  redistribute learned
 vrf 
  rd 172.16.0.71:5050
  route-target export evpn 5050:5050
  route-target import evpn 5050:5050
  redistribute connected
 int vxlan 1
  no shutdown
  vxlan source-interface loopback1
  vxlan vlan 10 vni 1010
  vxlan vlan 20 vni 1020
  vxlan vrf  vni 5050
  

interface Ethernet3
 description Uplink to Spine1
 no switchport
 ip address 10.10.1.14/30
 
interface Ethernet4
 description Uplink to Spine2
 no switchport
 ip address 10.10.2.14/30
 
interface Ethernet5
 description Uplink to Spine3
 no switchport
 ip address 10.10.3.14/30
 
interface Ethernet6
 description Uplink to Spine4
 no switchport
 ip address 10.10.4.14/30
 


interface Loopback0
 ip address 172.16.0.74/32
 no shutdown


service routing protocols model multi-agent
ip routing


 vrf instance VRF-A
 ip routing vrf VRF-A



vlan 30
 name Vlan30
 interface Vlan30
 vrf VRF-A
 ip address virtual 172.16.30.254/24
 no autostate
 no shutdown

vlan 40
 name Vlan40
 interface Vlan40
 vrf VRF-A
 ip address virtual 172.16.40.254/24
 no autostate
 no shutdown





ip virtual-router mac-address 001c.7300.0098

router bgp 65004
 router-id 172.16.0.74
 no bgp default ipv4-unicast
 maximum-paths 4 ecmp 4
 neighbor SpineUnderlay peer group
 neighbor 10.10.1.13 peer group SpineUnderlay
 neighbor 10.10.2.13 peer group SpineUnderlay
 neighbor 10.10.3.13 peer group SpineUnderlay
 neighbor 10.10.4.13 peer group SpineUnderlay
 neighbor SpineUnderlay remote-as 65000
 neighbor SpineOverlay send-community extended
 neighbor SpineUnderlay maximum-routes 12000
 address-family ipv4
  network 172.16.0.74/32
  redistribute connected
  neighbor SpineUnderlay activate
 
 neighbor SpineOverlay peer group
 neighbor 172.16.0.101 peer group SpineOverlay
 neighbor 172.16.0.102 peer group SpineOverlay
 neighbor 172.16.0.103 peer group SpineOverlay
 neighbor 172.16.0.104 peer group SpineOverlay
 neighbor SpineOverlay remote-as 65000
 neighbor SpineOverlay update-source loopback0
 neighbor SpineOverlay send-community extended
 neighbor SpineOverlay ebgp-multihop 3
 neighbor SpineOverlay maximum-routes 12000
 address-family evpn
  neighbor SpineOverlay activate
 vlan 30
  rd 172.16.0.74:3030
  route-target both 3030:3030
  redistribute learned
 vlan 40
  rd 172.16.0.74:4040
  route-target both 4040:4040
  redistribute learned
 vrf VRF-A
  rd 172.16.0.74:5050
  route-target export evpn 5050:5050
  route-target import evpn 5050:5050
  redistribute connected
 int vxlan 1
  vxlan source-interface loopback0
  vxlan vlan 30 vni 3030
  vxlan vlan 40 vni 4040
  vxlan vrf VRF-A vni 5050
  